<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  
  <title>Tag: state_management | èŠå®…</title>
  <meta name="description" content="ç¾éº—çš„å¤ªé™½ç…§å¸¸å‡èµ· è‹¦ç—›çš„äººå€‘ä¾èˆŠæ­‡æ–¯åº•è£" />
  <meta name="keywords" content="ios,objective-c,swift,python,javascript,otaku,lision" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="æ•²ä»£ç çš„ï¼Œæ¯”è¾ƒå®…çš„å†…ç§">
<meta property="og:type" content="website">
<meta property="og:title" content="èŠå®…">
<meta property="og:url" content="https://lision.me/tags/state-management/index.html">
<meta property="og:site_name" content="èŠå®…">
<meta property="og:description" content="æ•²ä»£ç çš„ï¼Œæ¯”è¾ƒå®…çš„å†…ç§">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Lision">
<meta property="article:tag" content="ios,objective-c,swift,python,javascript,otaku,lision">
<meta name="twitter:card" content="summary">
  
  
    <link rel="icon" href="/favicon.png">
  

	<script src="https://use.typekit.net/eyf3hir.js"></script>
  <script>try{Typekit.load({ async: false });}catch(e){}</script>
  
<link rel="stylesheet" href="/style.css">

  <script>
    function setLoadingBarProgress(num) {
      document.getElementById('loading-bar').style.width=num+"%";
    }
  </script>
  
<!-- Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=" + "UA-118743071-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-118743071-1');
</script>
<!-- End Google Analytics -->


<meta name="generator" content="Hexo 5.4.0"></head>

<body>
  
  <div id="loading-bar-wrapper">
  <div id="loading-bar"></div>
</div>

  <script>setLoadingBarProgress(20)</script>
  
  <div id="site-wrapper">
    
    <header id="header">
	<div id="header-wrapper" class="clearfix">
		<a id="logo" href="/">
			<img src="/images/logo.png" />
			<span id="site-desc">
			  otaku's self-cultivation
      </span>
		</a>
		<button id="site-nav-switch">
	    <span class="icon icon-menu"></span>
	  </button>
	</div>
	<aside id="site-menu">
  	<nav>
  		
        <a href="/" class="nav-home nav">
          é¦–é¡µ
        </a>
      
        <a href="/archives" class="nav-archives nav">
          å½’æ¡£
        </a>
      
        <a target="_blank" rel="noopener" href="https://github.com/Lision" class="nav-about nav">
          å…³äº
        </a>
      
    </nav>
	</aside>
</header>
    <script>setLoadingBarProgress(40);</script>
    
    <main id="main" role="main">
      
	<section class="page-header tag">
    <h1>- <span>state_management</span> -</h1>
  </section>






<section class="post-list">
	
    <article class="post ">

  
  <h2 class="title">
    <a href="/flutter-state-management_0x00/">
      Flutter çŠ¶æ€ç®¡ç† 0x00 - åŸºç¡€çŸ¥è¯†åŠ State.setState èƒŒåé€»è¾‘
    </a>
  </h2>
  
  <time>
    3æœˆ 21, 2020
  </time>
  <section class="content">
	  <img src="/flutter-state-management_0x00/flutter_state_management_0x00.png" class="">
<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><blockquote>
<p>Emmmmmâ€¦æ­£å¼å¼€å§‹æ–‡ç« å‰å…ˆäº¤ä»£ä¸ªäº‹å„¿ï¼Œ2019 å¼€å¹´è®¡åˆ’é‚£ç¯‡æ–‡ç« è¢«æˆ‘åˆ äº†ã€‚åŸå› æ²¡å•¥ç‰¹åˆ«çš„ï¼Œå°±çœŸçš„åªæ˜¯è„¸ç–¼â€¦</p>
</blockquote>
<p>å˜›ï½ å¥½ä¹…æ²¡æ›´ Blog äº†ï¼Œæœ€è¿‘ç¬”è€…æ­£åœ¨å­¦ä¹  Flutter ç›¸å…³çš„çŸ¥è¯†ï¼ˆè²Œä¼¼ç°åœ¨å­¦ä¹Ÿä¸ç®—ç‰¹åˆ«æ™šï¼‰ï¼Œæ‰€ä»¥åç»­<strong>å¯èƒ½</strong>ä¼šæœ‰ä¸€æ³¢è¿ç»­çš„ Flutter ç›¸å…³çš„æ›´æ–°ï¼ˆå…³é”®å­—å·²åŠ ç²— ğŸ˜‚ï¼‰ã€‚</p>
<p>å› ä¸ºä¹‹å‰æˆ‘çš„æ–‡ç« å¤§å¤šæ˜¯æºç å‰–æç›¸å…³çš„ï¼Œæ‰€ä»¥è¿™æ¬¡å†³å®šæ¢ç§æ–¹å¼å…ˆä» Flutter å¼€å‘çš„çŠ¶æ€ç®¡ç†èŠèµ·ã€‚ç”±äºä¸ªäººèƒ½åŠ›ä¸è¶³ã€æ°´å¹³æœ‰é™ï¼Œæ–‡ç« ä¸­éš¾å…æœ‰çº°æ¼å’Œè°¬è¯¯ï¼ŒåŠ ä¸Šå·¥ä½œç¡®å®æ¯”è¾ƒå¿™å¯èƒ½æ²¡æœ‰æ—¶é—´æ ¡éªŒï¼Œå¸Œæœ›å‘ç°çš„æœ‹å‹èƒ½å¤Ÿåœ¨æ–‡ç« ä¸‹æ–¹è¯„è®ºäº¤æµè®¨è®ºï¼ˆä¸»è¦æ˜¯é¿å…è¯¯äººå­å¼Ÿï¼Œä¸è¿‡è¯„è®ºåº”è¯¥éœ€è¦ç§‘å­¦ä¸Šç½‘ï¼‰ã€‚</p>
<p>æœ¬æ–‡ä¼šç®€å•ä»‹ç» Flutter ä»¥åŠå£°æ˜å¼ç¼–ç¨‹æ€æƒ³å’Œä»£ç ç”»é£ï¼Œå¯¹æ¯” <code>StatelessWidget</code> &amp; <code>StatefulWidget</code> è¿™ä¸¤ä¸ªé‡è¦çš„ Widgetï¼Œå†èŠèŠ <code>setState</code> èƒŒåçš„é‚£äº›äº‹å„¿ã€‚</p>
<h2 id="ç´¢å¼•"><a href="#ç´¢å¼•" class="headerlink" title="ç´¢å¼•"></a>ç´¢å¼•</h2><ul>
<li>Flutter ç®€ä»‹</li>
<li>å£°æ˜å¼ UI &amp; å“åº”å¼ç¼–ç¨‹</li>
<li>Flutter å¦‚ä½•æ¸²æŸ“ Widget</li>
<li><code>StatelessWidget</code> &amp; <code>StatefulWidget</code></li>
<li><code>State.setState</code> èƒŒåçš„é‚£äº›äº‹å„¿</li>
</ul>
<h2 id="Flutter-ç®€ä»‹"><a href="#Flutter-ç®€ä»‹" class="headerlink" title="Flutter ç®€ä»‹"></a>Flutter ç®€ä»‹</h2><blockquote>
<p><a target="_blank" rel="noopener" href="https://flutter.dev/">Flutter</a> æ˜¯ Google å¼€æºçš„ UI å·¥å…·åŒ…ï¼Œå¸®åŠ©å¼€å‘è€…é€šè¿‡ä¸€å¥—ä»£ç åº“é«˜æ•ˆæ„å»ºå¤šå¹³å°ç²¾ç¾åº”ç”¨ï¼Œæ”¯æŒç§»åŠ¨ã€Webã€æ¡Œé¢å’ŒåµŒå…¥å¼å¹³å°ã€‚</p>
</blockquote>
<p>ã€Œ<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Write_once,_run_anywhere">Write once, run anywhere.</a>ã€å§‹ç»ˆæ˜¯å¤§å‰ç«¯å¼€å‘ä¹ƒè‡³æ•´ä¸ªç¨‹åºç•Œçš„ä¸€ä¸ªæ°¸æ’çš„è¯é¢˜ã€‚è¯šç„¶ Flutter çš„ç›®æ ‡ä¹Ÿæ˜¯å¦‚æ­¤ï¼Œä¸è¿‡å®ƒä¸ä¹‹å‰ä¸šç•Œå·²ç»å­˜åœ¨çš„ React Nativeã€Xamarinã€Hybrid ç­‰æ¡†æ¶æœ‰ä½•ä¸åŒï¼Ÿ</p>
<img src="/flutter-state-management_0x00/flutter_system_overview.png" class="">
<p>ä»ä¸Šå›¾å¯ä»¥çœ‹åˆ° Flutter çš„è®¾è®¡æ•´ä½“ä¸Šæœ‰ä¸‰å±‚æŠ½è±¡ï¼š</p>
<ul>
<li>æœ€ä¸Šå±‚ Framework å°è£…å¥½äº† Material å’Œ Cupertino è¿™ä¸¤ç§åˆ†åˆ«å¯¹åº” Android å’Œ iOS å®˜æ–¹è®¾è®¡é£æ ¼çš„ UI åº“ï¼Œé™¤æ­¤ä¹‹å¤–è¿˜åŒ…å«äº†æ¸²æŸ“ã€åŠ¨ç”»ã€ç»˜åˆ¶ã€æ‰‹åŠ¿ç­‰ç­‰ï¼Œè¿™ä¸€å±‚ä¸»è¦æ˜¯æä¾›ç»™å¼€å‘è€…ä¾¿æ·æ„å»º App ä½¿ç”¨çš„ï¼Œå…¶åœ¨å¼€å‘æ—¶ä¸º <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Just-in-time_compilation">JIT</a>ã€å‘å¸ƒæ—¶ä¸º <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Ahead-of-time_compilation">AOT</a> çš„ç‰¹æ€§å…¼é¡¾äº†å¼€å‘è°ƒè¯•çš„ä¾¿æ·ä¸çº¿ä¸Šè¿è¡Œçš„é«˜æ€§èƒ½ï¼›</li>
<li>Engine ä½œä¸ºä¸­é—´å±‚ï¼Œä½¿ç”¨ C/C++ å®ç°äº†ä¸€å¥—é«˜æ€§èƒ½ã€å¯ç§»æ¤çš„ Runtimeï¼Œå±è”½äº†å¹³å°é—´å·®å¼‚çš„åŒæ—¶æ”¯æ’‘äº†ä¸Šå±‚çš„ Flutter åº”ç”¨ã€‚</li>
<li>Embedder ç”±å¹³å°æŒ‡å®šè¯­è¨€å®ç°ï¼Œæä¾›äº† Flutter æ‰€éœ€çš„äº‹ä»¶å¾ªç¯ã€çº¿ç¨‹ã€æ¸²æŸ“ç­‰åŸºç¡€ APIã€‚</li>
</ul>
<p>Flutter é€šè¿‡è¿™å¥—æœºåˆ¶æ¥ç®¡äº†æœ€åº•å±‚çš„ç³»ç»Ÿæ¥å£ï¼Œæä¾›äº†ä¸€æ•´å¥—<strong>ä»åº•å±‚æ¸²æŸ“é€»è¾‘åˆ°ä¸Šå±‚å¼€å‘è¯­è¨€çš„å®Œæ•´è§£å†³æ–¹æ¡ˆ</strong>ï¼Œä½¿å¾—å®ƒæœ‰ç€è¶…è¶Š React Native çš„é«˜ä¿çœŸã€å¤šç«¯ä¸€è‡´çš„ä½“éªŒï¼Œå’Œè¶…è¶Š Web å®¹å™¨çš„é«˜æ€§èƒ½æ¸²æŸ“èƒ½åŠ›ã€‚</p>
<h2 id="å£°æ˜å¼-UI-amp-å“åº”å¼ç¼–ç¨‹"><a href="#å£°æ˜å¼-UI-amp-å“åº”å¼ç¼–ç¨‹" class="headerlink" title="å£°æ˜å¼ UI &amp; å“åº”å¼ç¼–ç¨‹"></a>å£°æ˜å¼ UI &amp; å“åº”å¼ç¼–ç¨‹</h2><h3 id="å£°æ˜å¼-UI"><a href="#å£°æ˜å¼-UI" class="headerlink" title="å£°æ˜å¼ UI"></a>å£°æ˜å¼ UI</h3><img src="/flutter-state-management_0x00/ui-equals-function-of-state.png" class="">
<p>è¿™å¼ å›¾å¾ˆå¥½çš„æè¿°äº†å£°æ˜å¼ UI çš„æ ¸å¿ƒæ€æƒ³ï¼Œç®€å•æ¥è¯´å°±æ˜¯é€šè¿‡ state ä½œä¸ºå…¥å‚æ ¹æ®å·²ç»å†™å¥½çš„æ„å»º func å°±èƒ½å¾—åˆ°æˆ‘ä»¬æƒ³è¦çš„ UI æ•ˆæœã€‚ä¸¾ä¸ª ğŸŒ° æ›´ç›´è§‚ï¼š</p>
<p>é»˜è®¤çš„ Flutter Demo ç•Œé¢ï¼š</p>
<img src="/flutter-state-management_0x00/flutter_default_demo.png" class="">
<p>å¯¹åº”çš„ä»£ç ï¼š</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> Scaffold(</span><br><span class="line">  appBar: AppBar(</span><br><span class="line">    title: Text(widget.title),</span><br><span class="line">  ),</span><br><span class="line">  body: Center(</span><br><span class="line">    child: Column(</span><br><span class="line">      mainAxisAlignment: MainAxisAlignment.center,</span><br><span class="line">      children: &lt;Widget&gt;[</span><br><span class="line">        Text(</span><br><span class="line">          <span class="string">&#x27;You have pushed the button this many times:&#x27;</span>,</span><br><span class="line">        ),</span><br><span class="line">        Text(</span><br><span class="line">          <span class="string">&#x27;<span class="subst">$_counter</span>&#x27;</span>,</span><br><span class="line">          style: Theme.of(context).textTheme.display1,</span><br><span class="line">        ),</span><br><span class="line">      ],</span><br><span class="line">    ),</span><br><span class="line">  ),</span><br><span class="line">  floatingActionButton: FloatingActionButton(</span><br><span class="line">    <span class="comment">// _incrementCounter å†…éƒ¨é€»è¾‘å¯å¿½ç•¥</span></span><br><span class="line">    onPressed: _incrementCounter,</span><br><span class="line">    tooltip: <span class="string">&#x27;Increment&#x27;</span>,</span><br><span class="line">    child: Icon(Icons.add),</span><br><span class="line">  ),</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>In flutter, everything is a widget.</p>
</blockquote>
<p>Emmmmmâ€¦å¯ä»¥æ³¨æ„åˆ°ä¸Šé¢çš„ä»£ç ä¸­ <code>children: &lt;Widget&gt;[...]</code> ä¸€è¡Œï¼ŒFlutter å¼€å‘ä¸­å°±æ˜¯é€šè¿‡è¿™ç§æ–¹å¼åµŒå¥—ç»„åˆ Widget æ¥æè¿°ç”¨æˆ·ç•Œé¢çš„ã€‚ä»è¿™ä¸€è§’åº¦è®²ï¼ŒWidget æ˜¯å¯¹ä¸€éƒ¨åˆ†ç”¨æˆ·ç•Œé¢çš„<strong>ä¸å¯å˜</strong>æè¿°ã€‚</p>
<p>é»˜è®¤çš„ Flutter Demo è·‘èµ·æ¥å¾ˆç®€å•ï¼Œæ¨èå¤§å®¶äº²èº«ä½“éªŒã€‚ç®€å•è¯´ä¸€ä¸‹æˆ‘çš„æ„Ÿå—ï¼Œå£°æ˜å¼ UI çš„ä¼˜åŠ¿å¾ˆå¤§ï¼Œå…·ä½“è¡¨ç°ä¸ºåªéœ€è¦åœ¨å†™ UI æ—¶å°†ä¸åŒ state å¯¹åº”çš„ UI å±•ç¤ºè€ƒè™‘å¹¶æè¿°æ¸…æ¥šå°±å¯ä»¥çœå»åç»­ state å˜æ›´æ—¶å‘½ä»¤å¼ UI éœ€è¦æ‰‹åŠ¨ç®¡ç†è§†å›¾å±‚çº§ï¼ˆæ–°å¢æˆ–åˆ é™¤è§†å›¾å…ƒç´ ï¼‰å’Œæ›´æ–°å±æ€§ï¼ˆé¢œè‰²ã€å­—å·ç­‰ï¼‰ç­‰éº»çƒ¦ã€‚</p>
<blockquote>
<p>å€¼å¾—ä¸€æçš„æ˜¯ SwiftUI ä¹Ÿä½¿ç”¨äº†å£°æ˜å¼ UI çš„æ€æƒ³ï¼ˆå£°æ˜å¼ UI æ‰æ˜¯æœªæ¥ï¼‰ã€‚</p>
</blockquote>
<h3 id="å“åº”å¼ç¼–ç¨‹"><a href="#å“åº”å¼ç¼–ç¨‹" class="headerlink" title="å“åº”å¼ç¼–ç¨‹"></a>å“åº”å¼ç¼–ç¨‹</h3><blockquote>
<p><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Reactive_programming">å“åº”å¼ç¼–ç¨‹</a> ï¼Œåœ¨è®¡ç®—æœºé¢†åŸŸï¼Œå“åº”å¼ç¼–ç¨‹æ˜¯ä¸€ä¸ªä¸“æ³¨äºæ•°æ®æµå’Œå˜åŒ–ä¼ é€’çš„å¼‚æ­¥ç¼–ç¨‹èŒƒå¼ã€‚<br>è¿™æ„å‘³ç€å¯ä»¥ä½¿ç”¨ç¼–ç¨‹è¯­è¨€å¾ˆå®¹æ˜“åœ°è¡¨ç¤ºé™æ€ï¼ˆä¾‹å¦‚æ•°ç»„ï¼‰æˆ–åŠ¨æ€ï¼ˆä¾‹å¦‚äº‹ä»¶å‘å°„å™¨ï¼‰æ•°æ®æµï¼Œ<br>å¹¶ä¸”åœ¨å…³è”çš„æ‰§è¡Œæ¨¡å‹ä¸­ï¼Œå­˜åœ¨ç€å¯æ¨æ–­çš„ä¾èµ–å…³ç³»ï¼Œè¿™ä¸ªå…³ç³»çš„å­˜åœ¨æœ‰åˆ©äºè‡ªåŠ¨ä¼ æ’­ä¸æ•°æ®æµæœ‰å…³çš„æ›´æ”¹ã€‚</p>
</blockquote>
<p>å“åº”å¼ç¼–ç¨‹å¯¹äºå¤§å®¶æ¥è¯´åº”è¯¥æ—©å·²ä¸æ˜¯ä»€ä¹ˆæ–°é²œäº‹ç‰©äº†ï¼Œå•åœ¨ç§»åŠ¨å®¢æˆ·ç«¯é¢†åŸŸå°±æœ‰è¯¸å¦‚ <a target="_blank" rel="noopener" href="https://github.com/ReactiveCocoa/ReactiveCocoa">ReactiveCocoa</a>ã€<a target="_blank" rel="noopener" href="https://github.com/ReactiveX/RxSwift">RxSwift</a>ã€<a target="_blank" rel="noopener" href="https://github.com/ReactiveX/RxJava">RxJava</a>ã€RxXxxâ€¦ç®€å•æ¥è¯´è¿™ç§ç¼–ç¨‹æ€æƒ³æˆ–è€…è¯´èŒƒå¼ä¸‹å¼€å‘è€…åªéœ€å…³æ³¨å¯èƒ½å­˜åœ¨çš„æ•°æ®çŠ¶æ€ä»¥åŠä¸ä¹‹å¯¹åº”çš„é€»è¾‘ä»è€Œå¤§å¤§å‡è½»äº†ç»´æŠ¤è¿™äº›å¯¹åº”å…³ç³»ä¸çŠ¶æ€ç»†èŠ‚çš„å·¥ä½œè´Ÿæ‹…ã€‚å› ä¸ºç”¨è¿‡çš„äººéƒ½è¯´å¥½ï¼Œæ‰€ä»¥ç›®å‰æ¸æ¸è¢«æ¨ä¸ºç§»åŠ¨å®¢æˆ·ç«¯ä¹ƒè‡³æ•´ä¸ªå¤§å‰ç«¯çš„ä¸»æµç¼–ç¨‹æ€æƒ³ã€‚</p>
<p>ä¸éš¾çœ‹å‡ºå…¶å®å£°æ˜å¼ UI å’Œå“åº”å¼ç¼–ç¨‹ä»æ€æƒ³ä¸Šæ˜¯å®Œå…¨å¥‘åˆçš„ï¼Œæˆ‘ä»¬åªéœ€è¦å°†æ•°æ®æµå¯¹åº”åˆ° <code>UI=f(state)</code> å…¬å¼ä¸­çš„ state å°±å¯ä»¥äº†ã€‚</p>
<h2 id="Flutter-å¦‚ä½•æ¸²æŸ“-Widget"><a href="#Flutter-å¦‚ä½•æ¸²æŸ“-Widget" class="headerlink" title="Flutter å¦‚ä½•æ¸²æŸ“ Widget"></a>Flutter å¦‚ä½•æ¸²æŸ“ Widget</h2><img src="/flutter-state-management_0x00/how_flutter_render_widget.png" class="">
<p>åœ¨ä»‹ç» <code>StatelessWidget</code> ä¸ <code>StatefulWidget</code> ä¹‹å‰å…ˆè¦äº†è§£ä¸€ä¸‹ Flutter çš„æ¸²æŸ“æ¨¡å‹ï¼Œç®€å•æ¥è®² Flutter åœ¨æ¸²æŸ“ Widget æ—¶ç”¨åˆ°ä¸‰æ£µæ ‘ï¼š</p>
<ul>
<li>Widgetï¼Œè´Ÿè´£æè¿° Element çš„é…ç½®ã€‚</li>
<li>Elementï¼Œè´Ÿè´£ç®¡ç† Widget å’Œ RenderObject çš„ç”Ÿå‘½å‘¨æœŸã€‚</li>
<li>RenderObjectï¼Œè´Ÿè´£æ§åˆ¶å°ºå¯¸ï¼Œå¸ƒå±€å’Œç»˜åˆ¶å·¥ä½œã€‚</li>
</ul>
<p>ä¸€è¨€ä»¥è”½ä¹‹ï¼ŒElement ä¼šæ ¹æ®æˆ‘ä»¬ä¹¦å†™çš„ Widget å¯¹å…¶çš„é…ç½®æè¿°æ¥ç”Ÿæˆå¹¶ç®¡ç†å¯¹åº”çš„ Element ä¸ RenderObjectï¼Œç”± RenderObject è´Ÿè´£æœ€ç»ˆçš„ç»˜åˆ¶å·¥ä½œã€‚ </p>
<blockquote>
<p>NOTE: Element ä¼šæ ¹æ® Widget çš„æè¿°æœ€å¤§ç¨‹åº¦å¤ç”¨ç°æœ‰ Element ä¸ RenderObject ä»¥æå‡æ€§èƒ½ã€‚</p>
</blockquote>
<h2 id="StatelessWidget-amp-StatefulWidget"><a href="#StatelessWidget-amp-StatefulWidget" class="headerlink" title="StatelessWidget &amp; StatefulWidget"></a><code>StatelessWidget</code> &amp; <code>StatefulWidget</code></h2><h3 id="StatelessWidget"><a href="#StatelessWidget" class="headerlink" title="StatelessWidget"></a><code>StatelessWidget</code></h3><blockquote>
<p><code>StatelessWidget</code>, A widget that does not require mutable state.</p>
</blockquote>
<p><code>StatelessWidget</code> å¦‚å…¶å <code>Stateless</code>ï¼Œå®ƒä¸éœ€è¦è¿½è¸ª State å¹¶æ ¹æ® State æ›´æ–° UIï¼Œæ‰€ä»¥ä¸€èˆ¬ <code>StatelessWidget</code> å†…éƒ¨çš„å±æ€§ç”¨ <code>final</code> ä¿®é¥°å£°æ˜ä¸”æ„é€ æ–¹æ³•ä¸€èˆ¬ä»¥ <code>const</code> ä¿®é¥°ã€‚</p>
<blockquote>
<p>NOTE: <code>const</code> ä¿®é¥°çš„ Widget æ„é€ æ–¹æ³•ä½¿ç”¨æ—¶å¯ä»¥ææ•ˆã€‚</p>
</blockquote>
<h3 id="StatefulWidget"><a href="#StatefulWidget" class="headerlink" title="StatefulWidget"></a><code>StatefulWidget</code></h3><blockquote>
<p><code>StatefulWidget</code>, A widget that has mutable state.</p>
</blockquote>
<p><code>StatefulWidget</code> ä¸ <code>StatelessWidget</code> ä¸€æ ·ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ä¸€ç³»åˆ—ï¼ˆç»„åˆåµŒå¥—ï¼‰å…¶ä»–æ›´å…·ä½“æè¿° UI çš„ Widgetï¼ˆæ¯”å¦‚ <code>Text</code>ï¼‰æ¥æ„å»ºéƒ¨åˆ†ç”¨æˆ·ç•Œé¢ã€‚åŒºåˆ«åœ¨äº <code>Stateful</code>ï¼Œå³å®ƒéœ€è¦è¿½è¸ª State å¹¶æ ¹æ® State æ›´æ–° UIã€‚</p>
<h3 id="åŒºåˆ«"><a href="#åŒºåˆ«" class="headerlink" title="åŒºåˆ«"></a>åŒºåˆ«</h3><p><code>StatelessWidget</code> ä¸ <code>StatefulWidget</code> å¤§æ¦‚æ˜¯æˆ‘ä»¬ç”¨ Flutter æŠ€æœ¯æ ˆå¼€å‘ App æ—¶æœ€å¸¸æ‰“äº¤é“çš„ä¸¤ä¸ª Widget äº†ã€‚</p>
<p>å…±åŒç‚¹ï¼š</p>
<ul>
<li>è¿™ä¸¤ä¸ª Widget éƒ½å¯ä»¥ç”¨æ¥é€šè¿‡å¯¹å…¶ä»–ä¸€ç³»åˆ— Widget æ„å»ºå®Œæˆä¸€éƒ¨åˆ†ç”¨æˆ·ç•Œé¢çš„å°è£…ã€‚</li>
</ul>
<p>ä¸åŒç‚¹ï¼š</p>
<ul>
<li><code>StatelessWidget</code> æ›´é€‚ç”¨äºä¸€äº›ä¸éœ€é€šè¿‡ç”¨æˆ·äº¤äº’æˆ–å…¶ä»–åŸå› é€šè¿‡ State æ§åˆ¶æ›´æ–°çš„ UI å°è£…ã€‚</li>
<li><code>StatefulWidget</code> æ›´é€‚ç”¨äºè¿½è¸ªæŸä¸ªä¼šæ ¹æ®ç”¨æˆ·äº¤äº’æˆ–å…¶ä»–å› ç´ å½±å“çš„ Stateï¼Œå¹¶æ ¹æ®æœ€æ–°çš„ State å®æ—¶æ›´æ–°çš„ UI å°è£…ã€‚</li>
</ul>
<p>æ­¤å¤–ï¼ŒFlutter å¯¹äº <code>StateLessWidget</code> ä¸ <code>StatefulWidget</code> çš„ç»˜åˆ¶ä¹Ÿæœ‰å·®å¼‚ï¼š</p>
<ul>
<li><code>StatelessWidget</code> é€šè¿‡ <code>StatelessElement.build</code> è§¦å‘ build</li>
<li><code>StatefulWidget</code> é€šè¿‡ <code>StatefulElement.build</code> è§¦å‘ <code>State.build</code></li>
</ul>
<h2 id="State-setState-èƒŒåçš„é‚£äº›äº‹å„¿"><a href="#State-setState-èƒŒåçš„é‚£äº›äº‹å„¿" class="headerlink" title="State.setState èƒŒåçš„é‚£äº›äº‹å„¿"></a><code>State.setState</code> èƒŒåçš„é‚£äº›äº‹å„¿</h2><blockquote>
<p>NOTE: ä¸‹é¢åˆ†æçš„ <code>State.setState</code> æºç ç‰ˆæœ¬ä¸º Flutter SDK v1.9.1+hotfix.6ã€‚</p>
</blockquote>
<p>æˆ‘ä»¬è¿˜ä»¥ Flutter é»˜è®¤ Demo æ¥åˆ†æï¼Œåœ¨ Demo ä¸­æˆ‘ä»¬ç‚¹å‡»ç•Œé¢å³ä¸‹è§’çš„ <code>FloatingActionButton</code> (å°±æ˜¯è“è‰²å¸¦æœ‰ + å·çš„åœ†å½¢æŒ‰é’®)ä¹‹åä¼šåˆ·æ–°ç•Œé¢ï¼Œå±å¹•ä¸­é—´çš„ Text Widget ä¼šæ˜¾ç¤ºæŒ‰é’®è¢«æŒ‰ä¸‹çš„æ¬¡æ•°ã€‚</p>
<img src="/flutter-state-management_0x00/demo.gif" class="">
<p><code>FloatingActionButton</code> ç‚¹å‡»ä¹‹åè°ƒç”¨äº† <code>_incrementCounter</code> æ–¹æ³•ï¼š</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">_MyHomePageState</span> <span class="keyword">extends</span> <span class="title">State</span>&lt;<span class="title">MyHomePage</span>&gt; </span>&#123;</span><br><span class="line">  <span class="built_in">int</span> _counter = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">void</span> _incrementCounter() &#123;</span><br><span class="line">    setState(() &#123;</span><br><span class="line">      _counter++;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>_MyHomePageState._incrementCounter</code> å†…éƒ¨é€»è¾‘ä¹Ÿä»…ä»…æ˜¯è°ƒç”¨äº† <code>State.setState</code> è€Œå·²ã€‚æ­£å¦‚ Flutter æ‰€å®£ä¼ çš„å…¬å¼ <code>UI = f(state)</code> ä¸€æ ·ï¼Œå¼€å‘è€…åªéœ€è¦è°ƒç”¨ <code>State.setState</code> ä¼ å…¥ <code>VoidCallback</code> å†…éƒ¨å†™å¥½ç›¸å…³æ•°æ®æ›´æ–°é€»è¾‘å³å¯æ›´æ–° UIï¼Œé‚£ä¹ˆ Flutter æ˜¯å¦‚ä½•åšåˆ°è¿™ä¸€ç‚¹çš„å‘¢ï¼Ÿ</p>
<h3 id="State-setState-èƒŒåé€»è¾‘"><a href="#State-setState-èƒŒåé€»è¾‘" class="headerlink" title="State.setState èƒŒåé€»è¾‘"></a><code>State.setState</code> èƒŒåé€»è¾‘</h3><img src="/flutter-state-management_0x00/state_dot_set_state.png" class="">
<blockquote>
<p><code>State.setState</code> èƒŒåè°ƒç”¨åµŒå¥—è¾ƒå¤šï¼Œå®é™…æ‰€åšçš„äº‹æƒ…ç†è§£èµ·æ¥å´å¾ˆç®€å•ã€‚å¦‚ä¸å–œåœ¨æ–‡å†…é˜…è¯»æºç å¯ç›´æ¥è·³è½¬è‡³ã€Œæ€»ç»“ <code>State.setState</code> èƒŒåé€»è¾‘ã€å°èŠ‚çœ‹ç›¸å…³é€»è¾‘æ€»ç»“ã€‚</p>
</blockquote>
<h4 id="State-setState"><a href="#State-setState" class="headerlink" title="State.setState"></a><code>State.setState</code></h4><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@optionalTypeArgs</span></span><br><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">State</span>&lt;<span class="title">T</span> <span class="keyword">extends</span> <span class="title">StatefulWidget</span>&gt; <span class="keyword">extends</span> <span class="title">Diagnosticable</span> </span>&#123;</span><br><span class="line">  ...</span><br><span class="line">  <span class="meta">@protected</span></span><br><span class="line">  <span class="keyword">void</span> setState(VoidCallback fn) &#123;</span><br><span class="line">    <span class="comment">// assert ...</span></span><br><span class="line">    <span class="keyword">final</span> <span class="built_in">dynamic</span> result = fn() <span class="keyword">as</span> <span class="built_in">dynamic</span>;</span><br><span class="line">    <span class="comment">// assert ...</span></span><br><span class="line">    _element.markNeedsBuild();</span><br><span class="line">  &#125;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¯è§ <code>State.setState</code> å†…é™¤å»æ–­è¨€çš„é€»è¾‘åªæœ‰ä¸¤è¡Œä»£ç ï¼š</p>
<ul>
<li>æ‰§è¡Œå…¥å‚ <code>VoidCallback</code> é€»è¾‘ï¼ŒDemo ä¸­å¯¹åº” <code>_counter++;</code></li>
<li>æ‰§è¡Œ <code>_element.markNeedsBuild();</code></li>
</ul>
<h4 id="Element-markNeedsBuild"><a href="#Element-markNeedsBuild" class="headerlink" title="Element.markNeedsBuild"></a><code>Element.markNeedsBuild</code></h4><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Element</span> <span class="keyword">extends</span> <span class="title">DiagnosticableTree</span> <span class="keyword">implements</span> <span class="title">BuildContext</span> </span>&#123;</span><br><span class="line">  ...</span><br><span class="line">  <span class="keyword">void</span> markNeedsBuild() &#123;</span><br><span class="line">    <span class="comment">// assert ...</span></span><br><span class="line">    <span class="keyword">if</span> (!_active)</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    <span class="comment">// assert ...</span></span><br><span class="line">    <span class="keyword">if</span> (dirty)</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    _dirty = <span class="keyword">true</span>;</span><br><span class="line">    owner.scheduleBuildFor(<span class="keyword">this</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>Element.markNeedsBuild</code> å†…éƒ¨çš„é€»è¾‘ä¹Ÿå¾ˆç®€å•æ˜äº†ï¼š</p>
<ul>
<li>å¦‚æ­¤ Element ä¸å†æ´»è·ƒåˆ™ç›´æ¥ <code>return</code> æ— éœ€åšä»»ä½•äº‹</li>
<li>å¦‚æ­¤ Element å·²ç»è¢«æ ‡è®°ä¸º <code>dirty</code> ä¹Ÿæ— éœ€é‡å¤æ ‡è®°ç›´æ¥ <code>return</code></li>
<li>ä»¥ä¸Šæ¡ä»¶ä¸æ»¡è¶³æ—¶è¯´æ˜æ­¤ Element æ˜¯æ´»è·ƒä¸”éœ€è¦é‡æ–°æ„å»ºçš„ï¼Œæ‰€ä»¥æ ‡è®°ä¸º <code>dirty</code> åè°ƒç”¨ <code>owner.scheduleBuildFor(this);</code></li>
</ul>
<h4 id="BuildOwner-scheduleBuildFor"><a href="#BuildOwner-scheduleBuildFor" class="headerlink" title="BuildOwner.scheduleBuildFor"></a><code>BuildOwner.scheduleBuildFor</code></h4><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BuildOwner</span> </span>&#123;</span><br><span class="line">  ...</span><br><span class="line">  <span class="keyword">void</span> scheduleBuildFor(<span class="built_in">Element</span> element) &#123;</span><br><span class="line">    <span class="comment">// assert ...</span></span><br><span class="line">    <span class="keyword">if</span> (!_scheduledFlushDirtyElements &amp;&amp; onBuildScheduled != <span class="keyword">null</span>) &#123;</span><br><span class="line">      _scheduledFlushDirtyElements = <span class="keyword">true</span>;</span><br><span class="line">      onBuildScheduled();</span><br><span class="line">    &#125;</span><br><span class="line">    _dirtyElements.add(element);</span><br><span class="line">    element._inDirtyList = <span class="keyword">true</span>;</span><br><span class="line">    <span class="comment">// assert ...</span></span><br><span class="line">  &#125;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>BuildOwner.scheduleBuildFor(this);</code> å†…éƒ¨é€»è¾‘ä¹Ÿä¸å¤æ‚ï¼š</p>
<ul>
<li><code>!_scheduledFlushDirtyElements &amp;&amp; onBuildScheduled != null</code> å¯ä»¥ç†è§£ä¸ºå¦‚æœè¿˜æ²¡æœ‰å®‰æ’è¿‡åˆ·æ–°æ­¤ BuildOwner ä¸‹è¢«æ ‡è®°ä¸º Dirty çš„ Elements ä¸”å®‰æ’æ„å»ºçš„é€»è¾‘ä¸ä¸ºç©ºï¼Œæ»¡è¶³ä»¥ä¸Šæ¡ä»¶åˆ™å°†æ­¤ BuildOwner å®‰æ’åˆ·æ–° Dirty Elements çš„æ ‡è®°ç½®ä¸º <code>true</code></li>
<li>å°†ä¼ å…¥çš„ Element åŠ å…¥æ­¤ BuildOwner ç®¡ç†çš„ <code>_dirtyElements</code> å¹¶å°†æ­¤ Element <code>_inDirtyList</code> æ ‡è®°ä¸º <code>true</code></li>
</ul>
<h4 id="BuildOwner-onBuildScheduled"><a href="#BuildOwner-onBuildScheduled" class="headerlink" title="BuildOwner.onBuildScheduled"></a><code>BuildOwner.onBuildScheduled</code></h4><p>å…¶å® <code>onBuildScheduled();</code> è·Ÿä¸‹å»æ˜¯ BuildOwner å†…éƒ¨å±æ€§ <code>onBuildScheduled</code>ï¼Œç±»å‹ä¸º <code>VoidCallback</code>ï¼Œåœ¨ <code>WidgetsBinding.initInstances</code> æ—¶è¢«èµ‹å€¼ä¸º <code>WidgetsBinding._handleBuildScheduled</code>:</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">mixin</span> WidgetsBinding <span class="keyword">on</span> BindingBase, SchedulerBinding, GestureBinding, RendererBinding, SemanticsBinding &#123;</span><br><span class="line">  ...</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="keyword">void</span> initInstances() &#123;</span><br><span class="line">    ...</span><br><span class="line">    buildOwner.onBuildScheduled = _handleBuildScheduled;</span><br><span class="line">    ...</span><br><span class="line">  &#125;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>WidgetsBinding</code> å¯ä»¥ç†è§£ä¸º Widget å±‚ä¸ Flutter engine ä¹‹é—´çš„èƒ¶æ°´å±‚ï¼Œç¯‡å¹…åŸå› ä¸å±•å¼€è®²ï¼Œæˆ‘ä»¬ç›´æ¥çœ‹ <code>WidgetsBinding._handleBuildScheduled</code>ã€‚</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">mixin</span> WidgetsBinding <span class="keyword">on</span> BindingBase, SchedulerBinding, GestureBinding, RendererBinding, SemanticsBinding &#123;</span><br><span class="line">  ...</span><br><span class="line">  <span class="keyword">void</span> _handleBuildScheduled() &#123;</span><br><span class="line">    <span class="comment">// assert ...</span></span><br><span class="line">    ensureVisualUpdate();</span><br><span class="line">  &#125;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="SchedulerBinding-ensureVisualUpdate"><a href="#SchedulerBinding-ensureVisualUpdate" class="headerlink" title="SchedulerBinding.ensureVisualUpdate"></a><code>SchedulerBinding.ensureVisualUpdate</code></h4><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">mixin</span> SchedulerBinding <span class="keyword">on</span> BindingBase, ServicesBinding &#123;</span><br><span class="line">  ...</span><br><span class="line">  <span class="keyword">void</span> ensureVisualUpdate() &#123;</span><br><span class="line">    <span class="keyword">switch</span> (schedulerPhase) &#123;</span><br><span class="line">      <span class="keyword">case</span> SchedulerPhase.idle:</span><br><span class="line">      <span class="keyword">case</span> SchedulerPhase.postFrameCallbacks:</span><br><span class="line">        scheduleFrame();</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      <span class="keyword">case</span> SchedulerPhase.transientCallbacks:</span><br><span class="line">      <span class="keyword">case</span> SchedulerPhase.midFrameMicrotasks:</span><br><span class="line">      <span class="keyword">case</span> SchedulerPhase.persistentCallbacks:</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œé€šè¿‡å½“å‰ <code>SchedulerPhase</code> çš„çŠ¶æ€è¿›è¡Œå–èˆï¼Œä»…åœ¨ <code>SchedulerPhase.idle</code> &amp; <code>SchedulerPhase.postFrameCallbacks</code> æ—¶è°ƒç”¨ <code>scheduleFrame();</code>ã€‚</p>
<h4 id="SchedulerPhase-scheduleFrame"><a href="#SchedulerPhase-scheduleFrame" class="headerlink" title="SchedulerPhase.scheduleFrame"></a><code>SchedulerPhase.scheduleFrame</code></h4><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">mixin</span> SchedulerBinding <span class="keyword">on</span> BindingBase, ServicesBinding &#123;</span><br><span class="line">  ...</span><br><span class="line">  <span class="keyword">void</span> scheduleFrame() &#123;</span><br><span class="line">    <span class="keyword">if</span> (_hasScheduledFrame || !_framesEnabled)</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    <span class="comment">// assert ...</span></span><br><span class="line">    <span class="built_in">window</span>.scheduleFrame();</span><br><span class="line">    _hasScheduledFrame = <span class="keyword">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œçš„é€»è¾‘æ›´ç®€å•ï¼š</p>
<ul>
<li><code>_hasScheduledFrame || !_framesEnabled</code> å¯ç†è§£ä¸ºå¦‚æœå·²ç»å®‰æ’è¿‡ Frame æˆ–å½“å‰ Frame ä¸å¯ç”¨ï¼Œè¿™ç§æƒ…å†µç›´æ¥ <code>return</code></li>
<li>ä¸æ»¡è¶³ä¸Šè¿°æƒ…å†µåˆ™è°ƒç”¨ <code>window.scheduleFrame();</code> ç„¶åæ ‡è®° <code>_hasScheduledFrame</code> ä¸º <code>true</code></li>
</ul>
<h4 id="Window-scheduleFrame"><a href="#Window-scheduleFrame" class="headerlink" title="Window.scheduleFrame"></a><code>Window.scheduleFrame</code></h4><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> scheduleFrame() native <span class="string">&#x27;Window_scheduleFrame&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œçš„ <code>Window.scheduleFrame</code> æ˜¯ Native æ–¹æ³•ï¼Œå¯ä»¥ç†è§£ä¸ºé€šè¿‡ <code>Window</code> ä¸ Flutter engine æ‰“äº¤é“ï¼Œæ³¨å†Œäº† VSync å›è°ƒã€‚</p>
<h3 id="æ€»ç»“-State-setState-èƒŒåé€»è¾‘"><a href="#æ€»ç»“-State-setState-èƒŒåé€»è¾‘" class="headerlink" title="æ€»ç»“ State.setState èƒŒåé€»è¾‘"></a>æ€»ç»“ <code>State.setState</code> èƒŒåé€»è¾‘</h3><img src="/flutter-state-management_0x00/state_set_state_logic.png" class="">
<p>ç®€å•æ¥è¯´ <code>State.setState</code> å°±å¹²äº†è¿™ä¹ˆå‡ ä»¶äº‹ï¼š</p>
<ul>
<li>æ‰§è¡Œå…¥å‚ <code>VoidCallback</code> é€»è¾‘ï¼Œå³æ‰§è¡Œå¼€å‘è€…å†™å¥½çš„ä¿¡æ¯å˜æ›´é€»è¾‘</li>
<li>å°è¯•å°†å½“å‰ <code>StatefulWidget</code> å¯¹åº”çš„ <code>StatefulElement</code> æ ‡è®°ä¸º <code>dirty</code></li>
<li>é€šè¿‡ <code>BuildOwner.onBuildScheduled</code> åˆ° <code>SchedulerPhase.scheduleFrame</code> å†åˆ° <code>Window.scheduleFrame</code> ä¸€æ­¥æ­¥å®Œæˆäº† VSync çš„å›è°ƒæ³¨å†Œ</li>
</ul>
<p>æ³¨æ„ä¸Šé¢ <code>State.setState</code> ç¬¬äºŒæ¡ä¸»è¦é€»è¾‘å°±æ˜¯æŠŠ State å…³è”çš„ Element æ ‡è®°ä¸º <code>dirty</code>ã€‚åœ¨ VSync å›è°ƒåä¼šé€šè¿‡ Native åˆ° Flutter engine è°ƒç”¨ Flutter <code>_drawFrame</code> æ–¹æ³•ï¼Œå°†ä¹‹å‰æ ‡è®°ä¸º <code>dirty</code> çš„ Element é‡æ–°æ„å»ºï¼Œæœ€ç»ˆä¼šæ‰§è¡Œåˆ°å¼€å‘è€…ç†Ÿæ‚‰çš„ <code>State.build</code> æ–¹æ³•ã€‚</p>
<h4 id="State-build-æ˜¯å¦‚ä½•è¢«æ‰§è¡Œçš„"><a href="#State-build-æ˜¯å¦‚ä½•è¢«æ‰§è¡Œçš„" class="headerlink" title="State.build æ˜¯å¦‚ä½•è¢«æ‰§è¡Œçš„"></a><code>State.build</code> æ˜¯å¦‚ä½•è¢«æ‰§è¡Œçš„</h4><p>è¿™é‡Œå› ä¸ºç¯‡å¹…åŸå› ç®€å•æè¿°ä¸‹åç»­é€»è¾‘ï¼Œæ¯•ç«Ÿæœ¬æ–‡é‡ç‚¹ä¸åœ¨äº Flutter å¦‚ä½•æ¸²æŸ“ Widgetï¼š</p>
<ul>
<li>State æ˜¯å¼€å‘è€…é‡å†™ <code>StatefulWidget.createState</code> è¿”å›çš„</li>
<li>State å¯¹åº”çš„ Element æ˜¯ <code>StatefulWidget.createElement</code> è¿”å›çš„ï¼Œç±»å‹ä¸º <code>StatefulElement</code></li>
<li><code>StatefulElement</code> è¢«æ ‡è®°ä¸º <code>dirty</code> ååœ¨ Flutter <code>_drawFrame</code> æ—¶é‡æ–°æ„å»ºä¼šè°ƒç”¨ <code>StatefulElement.build</code>ï¼Œå…¶æºç ä¸º <code>Widget build() =&gt; state.build(this);</code></li>
<li><code>state.build(this)</code> ä¸­çš„ <code>state</code> å°±æ˜¯æˆ‘ä»¬çš„ Stateï¼Œå¼€å‘è€…å†™çš„ <code>State.build</code> æ–¹æ³•å°±è¿™æ ·è¢«æ‰§è¡Œäº†</li>
</ul>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>æœ¬æ–‡æ˜¯ Flutter çŠ¶æ€ç®¡ç†çš„å¼€ç¯‡ï¼Œä¸ºäº†ç…§é¡¾ä¸€äº›è¿˜æ²¡æ¥å¾—åŠå­¦ä¹  Flutter æˆ–è€…åˆšå…¥é—¨ Flutter çš„åˆå¿ƒè€…æ‰€ä»¥æ–‡ç« ä»å‰åˆ°ååšäº†ä¸€äº›é“ºå«ä»‹ç»è¿‡æ¸¡ã€‚æ–‡ç« å†…å®¹ä¹Ÿæ¯”è¾ƒæµ…æ˜¾æ˜“æ‡‚ï¼ŒåŸºæœ¬ä¸Šæ˜¯å›´ç»• Flutter åˆ›å»º App é»˜è®¤çš„ Demo æ¥å±•å¼€è®²è§£ä¸€äº›åŸºæœ¬çš„ Flutter çŸ¥è¯†ç‚¹ï¼š</p>
<ul>
<li>Flutter æ¸²æŸ“ Widget çš„ä¸‰é¢—æ ‘æ¦‚å¿µ</li>
<li><code>StatelessWidget</code> &amp; <code>StatefulWidget</code></li>
<li><code>State.setState</code> èƒŒåé€»è¾‘</li>
</ul>
<p>ç”±äºçŠ¶æ€ç®¡ç†è¿™ä¸ªè¯é¢˜éå¸¸å¤§ä¸”å¤æ‚ï¼Œæ–‡ç« å› ä¸ºç¯‡å¹…åŸå› å°±åˆ°è¿™é‡Œï¼Œåç»­çš„æ–‡ç« ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰åº”è¯¥ä¸ä¼šå†èŠ±å¤§ç¯‡å¹…åš Flutter åŸºç¡€çŸ¥è¯†çš„é“ºå«å’Œè¿‡æ¸¡äº†ï¼ˆä½†æ˜¯è¯¥æœ‰çš„å‰ç½®çŸ¥è¯†ç‚¹è‚¯å®šè¿˜ä¼šæœ‰ï¼‰ã€‚æ—¶é—´ç´§å¼ ï¼Œæ–‡ç« éš¾å…å‡ºç°è°¬è¯¯ï¼Œä¼°è®¡è‡ªå·±ä¹Ÿæ²¡æœ‰æ—¶é—´åšæ ¡å¯¹äº†ï¼Œæœ‰é—®é¢˜è¿˜æœ›åœ¨è¯„è®ºåŒºæé†’ã€‚</p>
<h3 id="æ‰©å±•è¡¥å……"><a href="#æ‰©å±•è¡¥å……" class="headerlink" title="æ‰©å±•è¡¥å……"></a>æ‰©å±•è¡¥å……</h3><p>å†™åˆ°è¿™é‡Œæˆ‘æ„è¯†åˆ° Flutter çŠ¶æ€ç®¡ç†è¿™ä¸ªè¯é¢˜ä¸‹å¯ä»¥å¼•å‡ºå¾ˆå¤šå€¼å¾—æŒ–æ˜çš„å†…å®¹ï¼Œè€Œä¸”ç¬”è€…åšä¿¡å£°æ˜å¼ UI + å“åº”å¼ç¼–ç¨‹ä¼šæ˜¯æœªæ¥ç§»åŠ¨å®¢æˆ·ç«¯ä¹ƒè‡³æ•´ä¸ªå¤§å‰ç«¯çš„ä¸»æµç¼–ç¨‹èŒƒå¼ã€‚é‰´äºæ­¤ï¼Œåç»­çš„æ–‡ç« è®¡åˆ’å›´ç»• Flutter çŠ¶æ€ç®¡ç†é€æ­¥æ·±æŒ–ï¼Œå†…å®¹ä¹Ÿå°†åœ¨ Flutter æŠ€æœ¯æ ˆçš„åŸºç¡€ä¸Šåšé€‚åº¦æ¨ªå‘å¯¹æ¯”ã€‚</p>
<p>Emmmmmâ€¦åç»­çš„æ–‡ç« å°†ä¼šå‘å¸ƒåœ¨æˆ‘çš„ã€Š<a target="_blank" rel="noopener" href="https://xiaozhuanlan.com/flutter_state_management">Flutter çŠ¶æ€ç®¡ç†</a>ã€‹å°ä¸“æ ã€‚è‡³äºä¸“æ å®šä»·å˜›ï¼Œç›®å‰éšä¾¿å®šäº† Â¥69ï¼ˆä½œä¸ºå°é€æ˜çš„æˆ‘ç‘Ÿç‘Ÿå‘æŠ– ing~ï¼‰ã€‚å…¶å®å€’ä¹Ÿä¸æ˜¯å¾ˆåœ¨æ„èƒ½å–å‡ºå¤šå°‘ä»½ï¼Œæˆ–è€…ä»ä¸­æ”¶åˆ°å¤šå°‘é’±ï¼Œæ¯•ç«Ÿè‡ªå·±å†™æ–‡ç« çš„ç²¾åŠ›æ‹¿å»éšä¾¿æ¥ä¸ªæœ‹å‹çš„ç§æ´»éƒ½åº”è¯¥æ¯”è¿™æ¬¡é€šè¿‡å°ä¸“æ èµšåˆ°çš„å¤šã€‚æ¯”èµ·æ”¶å…¥æ›´å¤šçš„æ˜¯å¯¹è‡ªå·±çš„é­ç­–å§ï¼Œæ¯•ç«Ÿæ˜¯æ”¶è´¹çš„ä¸œè¥¿ï¼Œåªè¦æœ‰ä¸€ä¸ªäººè®¢é˜…äº†è¿™ä¸ªä¸“æ å°±æ„å‘³ç€å¯¹æˆ‘çš„è‚¯å®šï¼Œæˆ‘å°±æœ‰è´£ä»»æŠŠè¿™ä¸ªæ–¹å‘æŒ–æ˜çš„æ›´æ·±å…¥ï¼ŒåŒæ—¶æ–‡ç« è´¨é‡ä¹Ÿåº”è¯¥æ¯”åšå®¢å†…å®¹æ›´é«˜ã€‚</p>
<blockquote>
<p>å…¶å®æ—©åœ¨å»å¹´å°±æœ‰å¹¸è¢«å°ä¸“æ çš„å¼€å‘è€…<a target="_blank" rel="noopener" href="https://weibo.com/apkbus?is_all=1">@å®‰å“å¤§ç‹å­</a>é‚€è¯·å»å°ä¸“æ å†™æ–‡ç« ï¼Œä¸è¿‡å½“æ—¶è‡ªå·±æ„Ÿè§‰æ²¡ä»€ä¹ˆå¥½çš„å†…å®¹æ–¹å‘æ‰€ä»¥åªæ˜¯å¼€é€šäº†ä¸“æ ä½†æ²¡æœ‰ä»»ä½•è¾“å‡ºã€‚æ—¶è‡³ä»Šæ—¥ç»ˆäºæ‰¾åˆ°äº†ä¸€ä¸ªå€¼å¾—æ·±æŒ–çš„æ–¹å‘ï¼Œè‡ªç„¶è€Œç„¶æƒ³åˆ°äº†è¿™ä¸ªå¹³å°ã€‚ä¸ªäººæ„Ÿè§‰<a target="_blank" rel="noopener" href="https://xiaozhuanlan.com/">å°ä¸“æ </a>è¿™ä¸ªå¹³å°æ²¡æœ‰å¤ªé‡çš„å•†ä¸šåŒ–å‘³é“ï¼Œè¿™ç‚¹å¾ˆè®¨å–œï¼Œåœ¨å¾®ä¿¡ä¸Šé¢çš„é˜…è¯»ä½“éªŒä¹Ÿæ¯”è‡ªå·±å‘å…¬ä¼—å·è¦å¥½ä¸€äº›ï¼Œæ›´éš¾èƒ½å¯è´µçš„æ˜¯çœå»äº†å‘å…¬ä¼—å·çš„ç¹çæ“ä½œæµç¨‹ã€‚å¯èƒ½æ­£æ˜¯å•†ä¸šåŒ–æ°›å›´å¼±çš„åŸå› ï¼Œä¸Šé¢çš„æ–‡ç« è´¨é‡è¿˜éƒ½æŒºä¸é”™çš„ï¼Œæ¨èå„ä½è¯»è€…æœ‹å‹å¯ä»¥ä¸Šå»è¯•è¯»æˆ–è€…å†™ä½œã€‚</p>
</blockquote>


    
    
    
	  <div class="tags">
      <a class="tag-none-link" href="/tags/design-patterns/" rel="tag">design_patterns</a><a class="tag-none-link" href="/tags/state-management/" rel="tag">state_management</a>
	  </div>
    

  </section>
</article>
  
</section>


      <script>setLoadingBarProgress(60);</script>
    </main>
    
    <footer id="footer" class="clearfix">
  
  
	<div class="search">
	  <script>
      (function() {
        var cx = '001858749347000340533:drswradlp64';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
    <gcse:searchbox-only></gcse:searchbox-only>
	</div>
	

	<div class="social-wrapper">
  	
      
        <a href="mailto:lisionmail@gmail.com" class="social email"
          target="_blank" rel="external">
          <span class="icon icon-email"></span>
        </a>
      
        <a href="https://github.com/Lision" class="social github"
          target="_blank" rel="external">
          <span class="icon icon-github"></span>
        </a>
      
        <a href="https://twitter.com/LisionChat" class="social twitter"
          target="_blank" rel="external">
          <span class="icon icon-twitter"></span>
        </a>
      
        <a href="https://weibo.com/lisioncode" class="social sina-weibo"
          target="_blank" rel="external">
          <span class="icon icon-sina-weibo"></span>
        </a>
      
    
  </div>
  
  <div>Theme <span class="codename">Typescript</span> designed by <a href="http://rakugaki.me/" target="_blank">Art Chen</a>.</div>
  <div>&copy; <a href="/">èŠå®…</a></div>
  
</footer>


    <script>setLoadingBarProgress(80);</script>
    
  </div>

  
<script>
  var disqus_shortname = 'lision-me';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>




<script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
<script>window.jQuery || document.write('<script src="/js/jquery.min.js"><\/script>')</script>


<script src="/js/jquery.fitvids.js"></script>

<script>
	var GOOGLE_CUSTOM_SEARCH_API_KEY = "AIzaSyAMIoydL742ROhE6lLk9n3hT0pZwbrXD_I";
	var GOOGLE_CUSTOM_SEARCH_ENGINE_ID = "001858749347000340533:drswradlp64";
	var ALGOLIA_API_KEY = "";
	var ALGOLIA_APP_ID = "";
	var ALGOLIA_INDEX_NAME = "";
  var AZURE_SERVICE_NAME = "";
  var AZURE_INDEX_NAME = "";
  var AZURE_QUERY_KEY = "";
  var BAIDU_API_ID = "";
  var SEARCH_SERVICE = "google";
</script>

<script src="/js/search.js"></script>


<script src="/js/app.js"></script>



  <script>setLoadingBarProgress(100);</script>
  
</body>
</html>
